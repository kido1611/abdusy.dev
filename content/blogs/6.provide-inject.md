---
title: "Provide And Inject"
description: "Providing value from parent to child without prop"
author: "Muhammad Abdusy Syukur"
created_at: "2024-02-10 19:48:10"
---

# Provide and Inject

Providing value from `parent` component to (nested) `child` component without annoying prop.

Source : Vue [Provide / Inject](https://vuejs.org/guide/components/provide-inject)

## Problem

Ketika ada sub component (nested) ingin mengakses data dari parent, yang harus dilakukan adalah melakukan passing data dari parrent ke child ke sub child.

<figure>
    <img src="https://vuejs.org/assets/prop-drilling.FyV2vFBP.png"
         alt="Passing data menggunakan prop">
    <figcaption>Passing data menggunakan prop. Source: vuejs.org</figcaption>
</figure>

Cara diatas tidaklah salah, namun ada yang lebih baik, yakni dengan menggunakan `Provide` & `Inject` ([docs](https://vuejs.org/guide/components/provide-inject)). Dengan menggunakan `Provide` & `Inject`, prop bisa dihilangkan dan sub child bisa langsung mengakses data ke parent.

<figure>
    <img src="https://vuejs.org/assets/provide-inject.tIACH1Z-.png"
         alt="Penggunaan Provide & Inject">
    <figcaption>Penggunaan Provide & Inject. Source: vuejs.org</figcaption>
</figure>

Provide digunakan oleh parent sebagai penyedia data, dan Inject digunakan oleh (sub)child component sebagai penerima/pengambil data.

## Contoh

Pada kasus ini akan dibuat kasus dengan hierarki elemen : `Parent` -> `Child` -> `SubChild`

### Prop Event

Hasil bisa dilihat di halaman [Page Prop Event](/examples/prop-event)

#### Parent

```vue
<template>
  <div>
    <h1>Page Prop Event</h1>
    <div class="divide-y divide-gray-400">
      <section>
        <h2>Parent</h2>
        <p>User: {{ user }}</p>
        <div class="flex flex-row items-center space-x-3">
          <button @click="login">Login</button>
          <button @click="logout">Logout</button>
        </div>
      </section>

      <ProvideInjectChild :user="user" @login="login" @logout="logout" />
    </div>
  </div>
</template>

<script lang="ts" setup>
import type { User } from "./../../../types";

const user = ref<User>();

function login() {
  user.value = {
    id: "user-id",
    name: "Muhammad Abdusy Syukur",
  };
}

function logout() {
  user.value = undefined;
}
</script>
```

#### Child

```vue
<template>
  <div class="divide-y divide-gray-400">
    <section>
      <h2>Child</h2>

      <p>User: {{ prop.user }}</p>
    </section>

    <ProvideInjectSubChild :user="prop.user" @login="login" @logout="logout" />
  </div>
</template>

<script lang="ts" setup>
import type { User } from "../../types";
const prop = defineProps<{
  user?: User;
}>();

const emit = defineEmits<{
  login: [];
  logout: [];
}>();

function login() {
  emit("login");
}

function logout() {
  emit("logout");
}
</script>
```

#### SubChild

```vue
<template>
  <section>
    <h2>SubChild</h2>

    <p>User: {{ prop.user }}</p>
    <div class="flex flex-row items-center space-x-3">
      <button @click="login">Login</button>
      <button @click="logout">Logout</button>
    </div>
  </section>
</template>

<script lang="ts" setup>
import type { User } from "../../types";
const prop = defineProps<{
  user?: User;
}>();

const emit = defineEmits<{
  login: [];
  logout: [];
}>();

function login() {
  emit("login");
}

function logout() {
  emit("logout");
}
</script>
```

### Provide & Inject

Hasil bisa dilihat di halaman [Page Provide Inject](/examples/provide-inject)

#### Types

```ts
export type User = {
  id: string;
  name: string;
};

export type UserInject = {
  user?: Ref<User | undefined>;
  login: () => void;
  logout: () => void;
};
```

#### Symbols

```ts
import type { InjectionKey } from "vue";
import type { UserInject } from "./types";

export const ProvideInjectKey: InjectionKey<UserInject> =
  Symbol("provide-inject");
```

#### Parent

```vue
<template>
  <div>
    <h1>Page Provide Inject</h1>
    <div class="divide-y divide-gray-400">
      <section>
        <h2>Parent</h2>
        <p>User: {{ user }}</p>
        <div class="flex flex-row items-center space-x-3">
          <button @click="login">Login</button>
          <button @click="logout">Logout</button>
        </div>
      </section>
      <ProvideInjectChild />
    </div>
  </div>
</template>

<script lang="ts" setup>
import type { User, UserInject } from "~/types";
import { ProvideInjectKey } from "@/symbols";

const user = ref<User>();

function login() {
  user.value = {
    id: "user-id",
    name: "Muhammad Abdusy Syukur",
  };
}

function logout() {
  user.value = undefined;
}

provide(ProvideInjectKey, {
  user: user,
  login: login,
  logout: logout,
});
</script>
```

#### Child

```vue
<template>
  <div class="divide-y divide-gray-400">
    <section>
      <h2>Child</h2>

      <p>Component ini sengaja dibuat tidak menampilkan data</p>
    </section>

    <ProvideInjectSubChild />
  </div>
</template>

<script lang="ts" setup></script>
```

#### SubChild

```vue
<template>
  <section>
    <h2>SubChild</h2>

    <p>User: {{ user }}</p>
    <div class="flex flex-row items-center space-x-3">
      <button @click="login">Login</button>
      <button @click="logout">Logout</button>
    </div>
  </section>
</template>

<script lang="ts" setup>
import { ProvideInjectKey } from "@/symbols";

const { user, login, logout } = inject(ProvideInjectKey, {
  user: undefined,
  login: () => {},
  logout: () => {},
});
</script>
```

## Problem Menggunakan Provide Inject

Ketika menggunakan Provide Inject, data yang diberikan masih bersifat reactive, sehingga data bisa diubah secara langsung dari subchild component.

```vue /components/ProvideinjectSubChild.vue
<template>
  ...
  <button @click="change">Change</button>
  ...
</template>

<script lang="ts" setup>
...
function change() {
  if (user && user.value) {
    user.value.name = user?.value?.name + "change";
  }
}
</script>
```

Untuk mengatasi hal tersebut, data sebelum disimpan dalam `provide` harus diubah menjadi `readonly`

```vue /pages/provide-inject.vue
<script lang="ts" setup>
...
provide(ProvideInjectKey, {
  user: readonly(user),
  login: login,
  logout: logout,
});
</script>
```
